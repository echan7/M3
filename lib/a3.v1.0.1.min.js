!function(t,e){"use strict";if("object"==typeof exports)module.exports=e(require("d3"),require("crossfilter"));else if("function"==typeof define&&define.amd)define(["d3"],["crossfilter"],function(o,r){return t.a3=e(o,r),t.a3});else if(t.d3&&t.crossfilter)t.a3=e(t.d3,t.crossfilter);else if(console&&console.warn)t.d3?t.crossfilter||console.warn("a3 requires crossfilter to run. Are you missing a reference to crossfilter library?"):console.warn("a3 requires d3 to run.  Are you missing a reference to the d3 library?");else{if(!t.d3)throw"a3 requires d3 to run.  Are you missing a reference to the d3 library?";if(!t.crossfilter)throw"a3 requires crossfilter to run. Are you missing a reference to crossfilter library?"}}(this,function(t,e){"use strict";var o={version:"1.0.1",plot:{}};return o.plot.setUp=function(e){function o(t,e){return!0!==t||0==e?0:Math.floor(Math.random()*e)-e/2}function r(t,e,o){i(t,e,o);var r={height:f.objs.legend.node().getBBox().height,width:f.objs.legend.node().getBBox().width};return f.objs.legend&&(f.objs.legend.selectAll("g").remove(),f.objs.legend.selectAll("text").remove()),f.objs.legend.remove(),r}function s(t,e,o,r){f.width-=e.width,f.xScale.range([0,f.width]),f.objs.xAxis.scale(f.xScale),f.objs.axes.xAxis.call(f.objs.xAxis),f.objs.g.select(".x.axis .label").attr("x",f.width/2),f.objs.g.select(".x.axis .caption").attr("x",f.width/2),f.objs.yAxis.tickSizeInner(-f.width),f.objs.axes.yAxis.call(f.objs.yAxis),i(t,o,r)}function i(t,e,o){f.objs.legend=f.objs.g.append("g").attr("class","legend-wrapper"),f.objs.legend.append("text").attr("class","legend-title").attr("x",-18+f.width).attr("y",0).text(o.toUpperCase());var r=f.objs.legend.selectAll(".legend").data(x(e.domain())).enter().append("g").attr("class","legend-point").attr("transform",function(t,e){return"translate("+(f.width-18-4)+","+(22*e+5)+")"});r.append("rect").attr("class",t+"-legend").attr("width",18).attr("height",18).style("fill",e).style("stroke",e),r.append("text").attr("x",22).attr("y",14).style("fill","black").text(function(t){return t})}function a(e){var o={max:null,upperOuterFence:null,upperInnerFence:null,quartile3:null,median:null,mean:null,quartile1:null,iqr:null,lowerInnerFence:null,lowerOuterFence:null,min:null};o.max=t.max(e),o.quartile3=t.quantile(e,.75),o.median=t.median(e),o.mean=t.mean(e),o.quartile1=t.quantile(e,.25),o.iqr=o.quartile3-o.quartile1,o.min=t.min(e);for(var r=o.quartile1-1.5*o.iqr,s=o.quartile3+1.5*o.iqr,i=0;i<e.length;i++)if(!(e[i]<r))if(!o.lowerInnerFence&&e[i]>=r)o.lowerInnerFence=e[i];else if(e[i]>s){o.upperInnerFence=e[i-1];break}return o.lowerOuterFence=o.quartile1-3*o.iqr,o.upperOuterFence=o.quartile3+3*o.iqr,o.lowerInnerFence||(o.lowerInnerFence=o.min),o.upperInnerFence||(o.upperInnerFence=o.max),o}function l(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e}function n(e){return e%1!=0?t.format(".2f")(e):t.format(".0f")(e)}function b(e){if("function"==typeof e)return e;if(Array.isArray(e)){var o={},r=0;for(var s in f.groupObjs)o[s]=e[r],r=(r+1)%e.length;return function(t){return o[t]}}return"object"==typeof e?function(t){return e[t]}:t.scaleOrdinal(t.schemeCategory10)}function c(t,e,o){var r={left:null,right:null,middle:null},s=t.bandwidth()*(e/100),i=(t.bandwidth()-s)/2,a=t(o);return r.middle=t.bandwidth()/2+a,r.left=i+a,r.right=r.left+s,r}function u(t){var e=Math.log(t)/Math.log(10)+1e-6;return Math.abs(e-Math.floor(e))<.6?n(t):""}function g(t){for(var e=[],o=Object.keys(t),r=0;r<o.length;r++){var s;s="string"==typeof t[o[r]]?"number"!=typeof parseFloat(t[o[r]])||isNaN(parseFloat(t[o[r]]))||parseFloat(t[o[r]]).toString().length!=t[o[r]].length?t[o[r]]:n(parseFloat(t[o[r]])):"number"==typeof t[o[r]]?n(t[o[r]]):t[o[r]],e.push(o[r].charAt(0).toUpperCase()+o[r].slice(1)+": "+s)}return e}function x(e){var o=!1;for(var r in e){if("number"!=typeof parseFloat(e[r])||isNaN(parseFloat(e[r]))||parseFloat(e[r]).toString().length!=e[r].toString().length){o=!1;break}o=!0}if(o)return e.sort(t.ascending);var s=e.slice().reduce(function(t,e){return t.length>e.length?t:e});for(var r in e){var i=Array(s.length+1).join(" ");e[r]=(i+e[r]).slice(-s.length)}return e.sort(t.ascending),e=e.map(function(t){return t.replace(/(^\s+|\s+$)/g,"")})}function p(e,o,r,s,i){return function(){var a,l,n=0,b=0,c=0,u=0;o=parseFloat(o),r=parseFloat(r),s=parseFloat(s);var x=t.rgb(t.rgb(i).r+.4*(255-t.rgb(i).r),t.rgb(i).g+.4*(255-t.rgb(i).g),t.rgb(i).b+.4*(255-t.rgb(i).b)),p=t.rgb(t.rgb(i).r+.6*(255-t.rgb(i).r),t.rgb(i).g+.6*(255-t.rgb(i).g),t.rgb(i).b+.6*(255-t.rgb(i).b));f.objs.tooltip.append("circle").attr("class","circle-tooltipcircle").attr("cx",o).attr("cy",r).attr("r",s).call(function(t){t.attr("opacity",0).style("fill","none").style("stroke",i).style("stroke-width",1)}).transition().duration(350).ease(t.easeLinear).attr("r",s+5).call(function(t){t.attr("opacity",1).style("stroke-width",2)});var h=f.objs.tooltip.append("g"),d=h.append("rect").attr("class","circle-tooltipbox"),j=g(e);h.selectAll("dont").data(j).enter().append("text").attr("class","circle-tooltiptext").style("fill","black").text(function(t){return t}),h.each(function(){n=this.getBBox().width>n?this.getBBox().width:n,b=this.getBBox().height>b?this.getBBox().height:b}),h.selectAll("text").attr("x",0).attr("y",function(){return(u+=this.getBBox().height)-this.getBBox().height/2}),d.attr("x",-5).attr("y",-5).attr("height",Math.floor(u+5)-.5).attr("width",n+10).attr("rx",5).attr("ry",5).call(function(t){t.style("fill",p).style("stroke",x).style("stroke-width",2).style("opacity",.95)}),d.each(function(){n=this.getBBox().width>n?this.getBBox().width:n,c=this.getBBox().width>b?this.getBBox().height:b}),o+s+5+10+n<parseFloat(f.width)?(a=o+s+5+10,l=r-(u-(b-5))/2):o-s-(15+n)>0?(a=o-s-(15+n),l=r-(u-(b-5))/2):r+s+u+10+5<parseFloat(f.height)?(a=(a=(a=o-(10+n)/2)>0?a:10)+n<parseFloat(f.width)?a:parseFloat(f.width)-n-10,l=r+s+10):(a=(a=(a=o-(10+n)/2)>0?a:10)+n<parseFloat(f.width)?a:parseFloat(f.width)-n-10,l=r-u-(b-5)),l<0?l=0:l+c>f.height&&(l-=l+c-f.height),h.attr("transform","translate("+a+","+l+")")}}function h(e,o,r,s,i,a){return function(){var l,n,b=0,c=0,u=0,x=0;o=parseFloat(o),r=parseFloat(r),s=parseFloat(s),i=parseFloat(i);var p=t.rgb(t.rgb(a).r+.4*(255-t.rgb(a).r),t.rgb(a).g+.4*(255-t.rgb(a).g),t.rgb(a).b+.4*(255-t.rgb(a).b)),h=t.rgb(t.rgb(a).r+.6*(255-t.rgb(a).r),t.rgb(a).g+.6*(255-t.rgb(a).g),t.rgb(a).b+.6*(255-t.rgb(a).b));f.objs.tooltip.append("rect").attr("class","metrics-tooltipbox").attr("x",o).attr("y",r).attr("width",i).attr("height",s).call(function(t){t.attr("opacity",0).style("fill","none").style("stroke",a).style("stroke-width",1)}).transition().duration(350).ease(t.easeLinear).attr("x",o-5).attr("y",r-5).attr("width",i+10).attr("height",s+10).call(function(t){t.attr("opacity",1).style("stroke-width",2)});var d=f.objs.tooltip.append("g"),j=d.append("rect").attr("class","metrics-tooltipbox"),m=g(e);d.selectAll("dont").data(m).enter().append("text").attr("class","metrics-tooltiptext").style("fill","black").text(function(t){return t}),d.each(function(){b=this.getBBox().width>b?this.getBBox().width:b,c=this.getBBox().height>c?this.getBBox().height:c}),d.selectAll("text").attr("x",0).attr("y",function(){return(x+=this.getBBox().height)-this.getBBox().height/2}),j.attr("x",-5).attr("y",-5).attr("height",Math.floor(x+5)-.5).attr("width",b+10).attr("rx",5).attr("ry",5).call(function(t){t.style("fill",h).style("stroke",p).style("stroke-width",2).style("opacity",.95)}),j.each(function(){b=this.getBBox().width>b?this.getBBox().width:b,u=this.getBBox().width>c?this.getBBox().height:c}),o+i+5+10+b<parseFloat(f.width)?(l=o+i+5+10,n=r+s/2-(x-(c-5))/2):o-i-(15+b)>0?(l=o-(15+b),n=r+s/2-(x-(c-5))/2):r+s+x+10+5<parseFloat(f.height)?(l=(l=(l=o-(10+b)/2)>0?l:10)+b<parseFloat(f.width)?l:parseFloat(f.width)-b-10,n=r+s+10):(l=(l=(l=o-(10+b)/2)>0?l:10)+b<parseFloat(f.width)?l:parseFloat(f.width)-b-10,n=r-x-(c-5)),n<0?n=0:n+u>f.height&&(n-=n+u-f.height),d.attr("transform","translate("+l+" , "+n+")")}}function d(){return function(){f.objs.tooltip.selectAll("circle").remove(),f.objs.tooltip.selectAll("rect").remove(),f.objs.tooltip.selectAll("g").remove()}}var f={settings:{},yFormatter:null,yScale:null,xFormatter:null,xScale:null,data:null,groupObjs:{},objs:{},colorFunct:null,margin:{},axisMargin:null,svgWidth:null,svgHeight:null,width:null,height:null,xAxisLabel:null,yAxisLabel:null,yRange:[],xRange:[],selector:null};f.settings={data:null,xName:null,yName:null,selector:null,caption:null,axisLabels:{xAxis:null,yAxis:null},yTicks:1,xTicks:1,axisScale:{xAxis:"ordinal",yAxis:"linear"},chartSize:{width:800,height:400},margin:{top:20,right:50,bottom:20,left:10},axisMargin:25,constrainExtremes:!1,colors:t.scaleOrdinal(t.schemeCategory10)};for(var j in e)f.settings[j]=e[j];return f.data=f.settings.data,f.objs={mainDiv:null,innerDiv:null,chartDiv:null,svg:null,g:null,axes:null,xAxis:null,yAxis:null,tooltip:null},f.update=function(){return f.svgWidth=parseInt(f.objs.chartDiv.style("width"),10)-(f.margin.left+f.margin.right),f.svgHeight=parseInt(f.objs.chartDiv.style("height"),10)-(f.margin.top+f.margin.bottom),f.width=f.svgWidth-f.margin.left-f.margin.right,f.height=f.svgHeight-f.margin.top-f.margin.bottom,f.xScale.range([0,f.width]),f.yScale.range([f.height,0]),f.violinPlots&&1==f.violinPlots.options.show&&null!=f.violinPlots.options._yDomainVP&&f.yScale.domain(f.violinPlots.options._yDomainVP).nice().clamp(!0),f.objs.g.select(".x.axis").attr("transform","translate(0,"+f.height+")").call(f.objs.xAxis),f.objs.g.select(".y.axis").call(f.objs.yAxis.tickSizeInner(-f.width)),f.objs.g.select(".x.axis .label").attr("x",f.width/2),f.objs.g.select(".y.axis .label").attr("x",-f.height/2),f},function(){var t,e,o=null,r=null;for(t=0;t<f.data.length;t++)o=f.data[t][f.settings.xName],r=f.data[t][f.settings.yName],e=f.data[t],f.groupObjs.hasOwnProperty(o)?(f.groupObjs[o].values.push(r),f.groupObjs[o].tooltip.push(e)):(f.groupObjs[o]={},f.groupObjs[o].values=[r],f.groupObjs[o].tooltip=[e]);console.log("Chart = "),console.log(f)}(),f.margin=f.settings.margin,f.axisMargin=f.settings.axisMargin,f.svgWidth=f.settings.chartSize.width+f.axisMargin,f.svgHeight=f.settings.chartSize.height+f.axisMargin,f.width=f.settings.chartSize.width-f.margin.left-f.margin.right,f.height=f.settings.chartSize.height-f.margin.top-f.margin.bottom,f.colorFunct=b(f.settings.colors),f.settings.axisLabels.xAxis||f.settings.axisLabels.yAxis?(f.xAxisLabel=f.settings.axisLabels.xAxis,f.yAxisLabel=f.settings.axisLabels.yAxis):(f.xAxisLabel=f.settings.xName,f.yAxisLabel=f.settings.yName),"log"===f.settings.axisScale.yAxis?(f.yScale=t.scaleLog(),f.yFormatter=u,f.yRange=t.extent(f.data,function(t){return t[f.settings.yName]})):"ordinal"===f.settings.axisScale.yAxis?(f.yScale=t.scaleBand(),f.yRange=f.data.map(function(t){return t[f.settings.yName]}).filter(function(t,e,o){return o.indexOf(t)==e}),f.yRange=x(f.yRange)):"linear"===f.settings.axisScale.yAxis&&(f.yScale=t.scaleLinear(),f.yFormatter=n,f.yRange=t.extent(f.data,function(t){return t[f.settings.yName]})),"log"===f.settings.axisScale.xAxis?(f.xScale=t.scaleLog(),f.xFormatter=u,f.xRange=t.extent(f.data,function(t){return t[f.settings.xName]})):"ordinal"===f.settings.axisScale.xAxis?(f.xScale=t.scaleBand(),f.xRange=Object.keys(f.groupObjs),f.xRange=x(f.xRange)):"linear"===f.settings.axisScale.xAxis&&(f.xScale=t.scaleLinear(),f.xFormatter=n,f.xRange=t.extent(f.data,function(t){return t[f.settings.xName]})),console.log("Chart Range = "),console.log(f.yRange),f.yScale.range([f.height,0]).domain(f.yRange),"log"!==f.settings.axisScale.yAxis&&"linear"!==f.settings.axisScale.yAxis||f.yScale.nice().clamp(!0),f.xScale.range([0,f.width]).domain(f.xRange),"log"!==f.settings.axisScale.xAxis&&"linear"!==f.settings.axisScale.xAxis||f.xScale.nice().clamp(!0),f.objs.yAxis=t.axisLeft().scale(f.yScale).tickFormat(f.yFormatter).tickSize(5).tickSizeOuter(0).tickSizeInner(-f.width).ticks(10*f.settings.yTicks),f.objs.xAxis=t.axisBottom().scale(f.xScale).tickFormat(f.xFormatter).tickSize(5).tickSizeOuter(0).ticks(10*f.settings.xTicks),function(){function e(t,e,o){var r=0,s=0,i=null;return"linear"===e?i=t.ticks():"ordinal"===e&&(i=t.domain()),f.objs.svg.selectAll("text.foo").data(i).enter().append("text").text(function(t){return t}).each(function(){r=Math.max(this.getBBox().width+o.tickPadding(),r),s=Math.max(this.getBBox().height,s)}).remove(),{width:r,height:s}}f.objs.mainDiv=t.select(f.settings.selector).attr("class","chart-wrapper").style("max-width",f.svgWidth+"px"),f.objs.innerDiv=f.objs.mainDiv.append("div").attr("class","inner-wrapper"),f.objs.innerDiv.append("div").attr("class","outer-box").append("div").attr("class","inner-box"),f.selector=f.objs.innerDiv.select(".inner-box"),f.objs.chartDiv=f.selector,f.objs.svg=f.objs.chartDiv.append("svg").attr("class","chart-area").attr("width",f.svgWidth+f.axisMargin+f.margin.left).attr("height",f.svgHeight);var o=e(f.yScale,f.settings.axisScale.yAxis,f.objs.yAxis),r=e(f.xScale,f.settings.axisScale.xAxis,f.objs.xAxis);f.objs.g=f.objs.svg.append("g").attr("transform","translate("+(o.width+f.axisMargin+f.margin.left)+","+f.margin.top+")"),f.objs.axes=f.objs.g.append("g").attr("class","axes"),f.objs.axes.yAxis=f.objs.axes.append("g").attr("class","y axis").call(f.objs.yAxis),f.objs.axes.yAxisLabel=f.objs.axes.yAxis.append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",-o.width-f.axisMargin).attr("x",-f.height/2).attr("dy",".71em").attr("fill","black").style("text-anchor","middle").style("font-weight","bold").text(f.yAxisLabel.toUpperCase()),f.objs.axes.xAxis=f.objs.axes.append("g").attr("class","x axis").attr("transform","translate(0,"+f.height+")").call(f.objs.xAxis),f.objs.axes.xAxisLabel=f.objs.axes.xAxis.append("text").attr("class","label").attr("x",f.width/2).attr("y",r.height+f.axisMargin).attr("fill","black").style("text-anchor","middle").style("font-weight","bold").text(f.xAxisLabel.toUpperCase());for(var s in f.groupObjs)f.groupObjs[s].g=f.objs.g.append("g").attr("class","group");f.settings.caption&&(f.objs.caption=f.objs.axes.xAxis.append("text").attr("class","caption").attr("fill","black").attr("x",f.width/2).attr("y",r.height+2*f.axisMargin).style("text-anchor","middle").style("font-weight","bold").text(f.settings.caption),f.svgHeight+=f.axisMargin,f.objs.svg.attr("height",f.svgHeight));var i;"ordinal"===f.settings.axisScale.xAxis?i=f.xScale.bandwidth():"linear"===f.settings.axisScale.xAxis&&(i=f.width/f.xRange),r.width>=i&&(f.objs.axes.xAxis.selectAll(".tick text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-90)"),f.objs.svg.attr("height",f.svgHeight+r.width),f.objs.axes.xAxisLabel.attr("y",r.width+f.axisMargin),f.objs.caption&&f.objs.caption.attr("y",r.width+2*f.axisMargin)),f.objs.tooltip=f.objs.g.append("g").attr("class","tooltip")}(),f.renderBoxPlot=function(e){f.boxPlots={};var i={show:!0,showBox:!0,showWhiskers:!0,showMedian:!0,showMean:!1,medianCSize:3.5,meanCSize:3.5,showOutliers:!0,boxWidth:30,lineWidth:null,scatterOutliers:!0,outlierCSize:2.5,extremeCSize:2.5,colors:f.colorFunct};f.boxPlots.options=l(i);for(var n in e)f.boxPlots.options[n]=e[n];var u=f.boxPlots.options;for(var g in f.groupObjs)f.groupObjs[g].boxPlot={},f.groupObjs[g].boxPlot.objs={};!function(){for(var e in f.groupObjs)if(!f.groupObjs[e].boxMetrics){f.groupObjs[e].boxMetrics={};var o=f.groupObjs[e].values.slice();o.sort(t.ascending),f.groupObjs[e].boxMetrics=a(o),f.groupObjs[e].boxMetrics.values=o;var r=f.groupObjs[e].tooltip.slice();r.sort(function(t,e){return t[f.settings.yName]-e[f.settings.yName]}),f.groupObjs[e].boxMetrics.tooltip=r}}();var x=function(){for(var t in f.groupObjs)!function(t){var e,o,r=[],s=[];for(o=0;o<t.boxMetrics.values.length;o++)(e={value:t.boxMetrics.values[o],tooltip:t.boxMetrics.tooltip[o]}).value<t.boxMetrics.lowerInnerFence?e.value<t.boxMetrics.lowerOuterFence?r.push(e):s.push(e):e.value>t.boxMetrics.upperInnerFence&&(e.value>t.boxMetrics.upperOuterFence?r.push(e):s.push(e));t.boxPlot.objs.outliers=s,t.boxPlot.objs.extremes=r}(f.groupObjs[t])}();return f.boxPlots.change=function(t){if(t)for(var e in t)u[e]=t[e];for(var o in f.groupObjs)f.groupObjs[o].boxPlot.objs.g.remove();f.boxPlots.prepareBoxPlot(),f.boxPlots.update()},f.boxPlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&f.boxPlots.reset()):t={show:!1},f.boxPlots.change(t)},f.boxPlots.prepareBoxPlot=function(){var t,e;if(u.colors?f.boxPlots.color=b(u.colors):f.boxPlots.color=f.colorFunct,0!=u.show){for(t in f.groupObjs)if(e=f.groupObjs[t].boxPlot,e.objs.g=f.groupObjs[t].g.append("g").attr("class","box-plot"),u.showBox&&(e.objs.box=e.objs.g.append("rect").attr("class","box").style("fill",f.boxPlots.color(t)).style("stroke",f.boxPlots.color(t))),u.showMedian&&(e.objs.median={line:null,circle:null},e.objs.median.line=e.objs.g.append("line").attr("class","median"),e.objs.median.circle=e.objs.g.append("circle").attr("class","median").attr("r",u.medianCSize).style("fill",f.boxPlots.color(t))),u.showMean&&(e.objs.mean={line:null,circle:null},e.objs.mean.line=e.objs.g.append("line").attr("class","mean"),e.objs.mean.circle=e.objs.g.append("circle").attr("class","mean").attr("r",u.meanCSize).style("fill",f.boxPlots.color(t))),u.showWhiskers&&(e.objs.upperWhisker={fence:null,line:null},e.objs.lowerWhisker={fence:null,line:null},e.objs.upperWhisker.fence=e.objs.g.append("line").attr("class","upper whisker").style("stroke",f.boxPlots.color(t)),e.objs.upperWhisker.line=e.objs.g.append("line").attr("class","upper whisker").style("stroke",f.boxPlots.color(t)),e.objs.lowerWhisker.fence=e.objs.g.append("line").attr("class","lower whisker").style("stroke",f.boxPlots.color(t)),e.objs.lowerWhisker.line=e.objs.g.append("line").attr("class","lower whisker").style("stroke",f.boxPlots.color(t))),u.showOutliers){e.objs.outliers||x();var o;if(e.objs.outliers.length){var i=e.objs.g.append("g").attr("class","boxplot outliers");for(o in e.objs.outliers)e.objs.outliers[o].point=i.append("circle").attr("class","outlier").attr("r",u.outlierCSize).style("fill",f.boxPlots.color(t))}if(e.objs.extremes.length){var a=e.objs.g.append("g").attr("class","boxplot extremes");for(o in e.objs.extremes)e.objs.extremes[o].point=a.append("circle").attr("class","extreme").attr("r",u.extremeCSize).style("stroke",f.boxPlots.color(t))}}f.violinPlots||s("box",r("box",f.boxPlots.color,f.settings.xName),f.boxPlots.color,f.settings.xName)}},f.boxPlots.reset=function(){f.boxPlots.change(i)},f.boxPlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&f.boxPlots.reset()):t={show:!0},f.boxPlots.change(t)},f.boxPlots.update=function(){var t,e;for(t in f.groupObjs){e=f.groupObjs[t].boxPlot;var r=c(f.xScale,u.boxWidth,t),s=r.right-r.left,i={};for(var a in f.groupObjs[t].boxMetrics)i[a]=null,i[a]=f.yScale(f.groupObjs[t].boxMetrics[a]);var n=l(f.groupObjs[t].boxMetrics);delete n.values,delete n.tooltip;var b,g,x,j;e.objs.box&&(e.objs.box.attr("x",r.left).attr("width",s).attr("y",i.quartile3).attr("rx",1).attr("ry",1).attr("height",-i.quartile3+i.quartile1),b=e.objs.box.attr("x"),g=e.objs.box.attr("y"),x=e.objs.box.attr("height"),s=e.objs.box.attr("width"),j=e.objs.box.style("fill"),e.objs.box.on("mouseover",h(n,b,g,x,s,j)).on("mouseout",d()));var m=null;m=u.lineWidth?c(f.xScale,u.lineWidth,t):r,e.objs.upperWhisker&&(e.objs.upperWhisker.fence.attr("x1",m.left).attr("x2",m.right).attr("y1",i.upperInnerFence).attr("y2",i.upperInnerFence),e.objs.upperWhisker.line.attr("x1",m.middle).attr("x2",m.middle).attr("y1",i.quartile3).attr("y2",i.upperInnerFence),e.objs.lowerWhisker.fence.attr("x1",m.left).attr("x2",m.right).attr("y1",i.lowerInnerFence).attr("y2",i.lowerInnerFence),e.objs.lowerWhisker.line.attr("x1",m.middle).attr("x2",m.middle).attr("y1",i.quartile1).attr("y2",i.lowerInnerFence)),e.objs.median&&(e.objs.median.line.attr("x1",m.left).attr("x2",m.right).attr("y1",i.median).attr("y2",i.median),e.objs.median.circle.attr("cx",m.middle).attr("cy",i.median),e.objs.box&&(e.objs.median.circle.on("mouseover",h(n,b,g,x,s,j)).on("mouseout",d()),e.objs.median.line.on("mouseover",h(n,b,g,x,s,j)).on("mouseout",d()))),e.objs.mean&&(e.objs.mean.line.attr("x1",m.left).attr("x2",m.right).attr("y1",i.mean).attr("y2",i.mean),e.objs.mean.circle.attr("cx",m.middle).attr("cy",i.mean),e.objs.box&&(e.objs.mean.circle.on("mouseover",h(n,b,g,x,s,j)).on("mouseout",d()),e.objs.mean.line.on("mouseover",h(n,b,g,x,s,j)).on("mouseout",d())));var y,v,w,P;if(e.objs.outliers&&u.showOutliers)for(P in e.objs.outliers)e.objs.outliers[P].point.attr("cx",r.middle+o(u.scatterOutliers,s)).attr("cy",f.yScale(e.objs.outliers[P].value)),n=e.objs.outliers[P].tooltip,y=e.objs.outliers[P].point.attr("cx"),v=e.objs.outliers[P].point.attr("cy"),w=e.objs.outliers[P].point.attr("r"),j=e.objs.outliers[P].point.style("fill"),e.objs.outliers[P].point.on("mouseover",p(n,y,v,w,j)).on("mouseout",d());if(e.objs.extremes&&u.showOutliers)for(P in e.objs.extremes)e.objs.extremes[P].point.attr("cx",r.middle+o(u.scatterOutliers,s)).attr("cy",f.yScale(e.objs.extremes[P].value)),n=e.objs.extremes[P].tooltip,y=e.objs.extremes[P].point.attr("cx"),v=e.objs.extremes[P].point.attr("cy"),w=e.objs.extremes[P].point.attr("r"),j=e.objs.extremes[P].point.style("stroke"),e.objs.extremes[P].point.on("mouseover",p(n,y,v,w,j)).on("mouseout",d())}},f.boxPlots.prepareBoxPlot(),t.select(window).on("resize.boxPlot",f.boxPlots.update),f.boxPlots.update(),f},f.renderViolinPlot=function(e){function o(t){return function(e){return Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}}function i(e,o){return function(r){return t.mean(o,function(t){return e(r-t)})}}function n(e,o){return function(r){return o.map(function(o){return{x:o,y:t.mean(r,function(t){return e(o-t)})}})}}f.violinPlots={};var u={show:!0,showViolinPlot:!0,resolution:100,bandWidth:20,width:50,interpolation:t.curveCardinal,clamp:0,colors:f.colorFunct,_yDomainVP:null};f.violinPlots.options=l(u);for(var g in e)f.violinPlots.options[g]=e[g];var x=f.violinPlots.options;for(var p in f.groupObjs)f.groupObjs[p].violin={},f.groupObjs[p].violin.objs={};return function(){for(var e in f.groupObjs)if(!f.groupObjs[e].boxMetrics){f.groupObjs[e].boxMetrics={};var o=f.groupObjs[e].values.slice();o.sort(t.ascending),f.groupObjs[e].boxMetrics=a(o),f.groupObjs[e].boxMetrics.values=o;var r=f.groupObjs[e].tooltip.slice();r.sort(function(t,e){return t[f.settings.yName]-e[f.settings.yName]}),f.groupObjs[e].boxMetrics.tooltip=r}}(),f.violinPlots.change=function(t){if(t)for(var e in t)x[e]=t[e];for(var o in f.groupObjs)f.groupObjs[o].violin.objs.g.remove();f.violinPlots.prepareViolin(),f.violinPlots.update()},f.violinPlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&f.violinPlots.reset()):t={show:!1},f.violinPlots.change(t)},f.violinPlots.prepareViolin=function(){var t,e;if(x.colors?f.violinPlots.color=b(x.colors):f.violinPlots.color=f.colorFunct,0!=x.show){for(t in f.groupObjs)(e=f.groupObjs[t].violin).objs.g=f.groupObjs[t].g.append("g").attr("class","violin-plot"),e.objs.left={area:null,line:null,g:e.objs.g.append("g")},e.objs.right={area:null,line:null,g:e.objs.g.append("g")},!1!==x.showViolinPlot&&(e.objs.left.area=e.objs.left.g.append("path").attr("class","area").style("fill",f.violinPlots.color(t)),e.objs.right.area=e.objs.right.g.append("path").attr("class","area").style("fill",f.violinPlots.color(t)),e.objs.left.line=e.objs.left.g.append("path").attr("class","line").style("fill","none").style("stroke",f.violinPlots.color(t)),e.objs.right.line=e.objs.right.g.append("path").attr("class","line").style("fill","none").style("stroke",f.violinPlots.color(t)));s("violin",r("violin",f.violinPlots.color,f.settings.xName),f.violinPlots.color,f.settings.xName)}},f.violinPlots.reset=function(){f.violinPlots.change(u)},f.violinPlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&f.violinPlots.reset()):t={show:!0},f.violinPlots.change(t)},f.violinPlots.update=function(){var e,r;for(e in f.groupObjs){r=f.groupObjs[e].violin;var s=f.yScale.copy();r.kde=n(o(x.bandWidth),s.ticks(x.resolution)),r.kdeData=r.kde(f.groupObjs[e].boxMetrics.values);var a=f.groupObjs[e].boxMetrics.max,l=f.groupObjs[e].boxMetrics.min;if(0==x.clamp||-1==x.clamp){if(a=t.min(r.kdeData.filter(function(t){return t.x>f.groupObjs[e].boxMetrics.max&&0==t.y}),function(t){return t.x}),l=t.max(r.kdeData.filter(function(t){return t.x<f.groupObjs[e].boxMetrics.min&&0==t.y}),function(t){return t.x}),-1==x.clamp){var b=i(o(x.bandWidth),f.groupObjs[e].boxMetrics.values);if(!a){for(var u=b(f.groupObjs[e].boxMetrics.max),g=f.groupObjs[e].boxMetrics.max,p=25;p>0&&0!=u;)u=b(g),g+=1,p-=1;a=g}if(!l){for(var h=b(f.groupObjs[e].boxMetrics.min),d=f.groupObjs[e].boxMetrics.min,p=25;p>0&&0!=h;)h=b(d),d-=1,p-=1;l=d}}x._yDomainVP||(x._yDomainVP=f.yRange.slice(0)),l&&l<x._yDomainVP[0]&&(x._yDomainVP[0]=l),a&&a>x._yDomainVP[1]&&(x._yDomainVP[1]=a)}x.showViolinPlot&&(s=f.yScale.copy(),r.kde=n(o(x.bandWidth),s.ticks(x.resolution)),r.kdeData=r.kde(f.groupObjs[e].boxMetrics.values)),r.kdeData=r.kdeData.filter(function(t){return!l||t.x>=l}).filter(function(t){return!a||t.x<=a})}for(e in f.groupObjs){r=f.groupObjs[e].violin;var j=c(f.xScale,x.width,e),m=(j.right-j.left)/2,y=t.scaleLinear().range([m,0]).domain([0,t.max(r.kdeData,function(t){return t.y})]).clamp(!0),v=t.area().curve(x.interpolation).x(function(t){return s(t.x)}).y0(m).y1(function(t){return y(t.y)}),w=t.line().curve(x.interpolation).x(function(t){return s(t.x)}).y(function(t){return y(t.y)});r.objs.left.area&&(r.objs.left.area.datum(r.kdeData).attr("d",v),r.objs.left.line.datum(r.kdeData).attr("d",w),r.objs.right.area.datum(r.kdeData).attr("d",v),r.objs.right.line.datum(r.kdeData).attr("d",w)),r.objs.left.g.attr("transform","rotate(90,0,0)   translate(0,-"+j.left+")  scale(1,-1)"),r.objs.right.g.attr("transform","rotate(90,0,0)  translate(0,-"+j.right+")")}},f.violinPlots.prepareViolin(),t.select(window).on("resize.violinPlot",f.violinPlots.update),f.violinPlots.update(),f},f.renderBubblePlot=function(e){f.bubblePlots={};var o={show:!0,showBubble:!0,bubbleWidth:30,bubbleVolume:"",colorBy:"",colors:f.colorFunct};f.bubblePlots.options=l(o);for(var i in e)f.bubblePlots.options[i]=e[i];var a=f.bubblePlots.options;for(var n in f.groupObjs)f.groupObjs[n].bubblePlot={},f.groupObjs[n].bubblePlot.objs={};return function(){var t,e,o=null;for(t=0;t<f.data.length;t++){o=f.data[t][f.settings.xName],e=f.data[t];var r={value:f.data[t][f.settings.yName],volume:f.data[t][a.bubbleVolume],color:f.data[t][a.colorBy],tooltip:e};f.groupObjs[o].bubbleValues?f.groupObjs[o].bubbleValues.push(r):f.groupObjs[o].bubbleValues=[r]}}(),f.bubblePlots.change=function(t){if(t)for(var e in t)a[e]=t[e];for(var o in f.groupObjs)f.groupObjs[o].bubblePlot.objs.g.remove();f.bubblePlots.prepareBoxPlot(),f.bubblePlots.update()},f.bubblePlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&f.bubblePlots.reset()):t={show:!1},f.bubblePlots.change(t)},f.bubblePlots.prepareBubblePlot=function(){var e,o;if(a.colors?f.bubblePlots.color=b(a.colors):f.bubblePlots.color=f.colorFunct,0!=a.show){var i;i="ordinal"===f.settings.axisScale.xAxis&&"ordinal"===f.settings.axisScale.yAxis?[3,.9*Math.min(f.xScale.bandwidth(),f.yScale.bandwidth())/2]:"ordinal"===f.settings.axisScale.xAxis&&"ordinal"!==f.settings.axisScale.yAxis?[3,.9*f.xScale.bandwidth()/2]:"ordinal"!==f.settings.axisScale.xAxis&&"ordinal"===f.settings.axisScale.yAxis?[3,.9*f.yScale.bandwidth()/2]:[3,30];var l=t.extent(f.data.map(function(t){return+t[a.bubbleVolume]})).map(function(t){for(var e=0;t>=10;)t/=10,e++;t=Math.floor(t);for(var o=0;o<e;o++)t*=10;return t}),n=l[1].toString().split("");n[0]=(parseInt(n[0])+1).toString(),l[1]=parseInt(n.join(""));var c=t.scaleSqrt().domain(l).range(i);for(e in f.groupObjs)if(o=f.groupObjs[e].bubblePlot,o.objs.bubble=[],o.objs.g=f.groupObjs[e].g.append("g").attr("class","bubble-plot"),a.showBubble)for(var u in f.groupObjs[e].bubbleValues){var g=f.groupObjs[e].bubbleValues[u].volume,x=f.groupObjs[e].bubbleValues[u].color;o.objs.bubble?o.objs.bubble.push(o.objs.g.append("circle").attr("class","bubble").attr("r",function(){return c(g)}).style("fill",f.bubblePlots.color(x)).style("opacity",.8)):(o.objs.bubble=[],o.objs.bubble=[o.objs.g.append("circle").attr("class","bubble").attr("r",function(){return c(g)}).style("fill",f.bubblePlots.color(x)).style("opacity",.8)])}s("bubble",r("bubble",f.bubblePlots.color,a.colorBy),f.bubblePlots.color,a.colorBy)}},f.bubblePlots.reset=function(){f.bubblePlots.change(o)},f.bubblePlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&f.bubblePlots.reset()):t={show:!0},f.bubblePlots.change(t)},f.bubblePlots.update=function(){var t,e;for(t in f.groupObjs){e=f.groupObjs[t].bubblePlot;var o,r;if("ordinal"===f.settings.axisScale.xAxis?o=c(f.xScale,a.bubbleWidth,t).middle:"linear"===f.settings.axisScale.xAxis&&(o=f.xScale(t)),e.objs.bubble)for(var s in f.groupObjs[t].bubbleValues){var i=f.groupObjs[t].bubbleValues[s].value,l=f.groupObjs[t].bubbleValues[s].tooltip;"ordinal"===f.settings.axisScale.yAxis?r=c(f.yScale,a.bubbleWidth,i).middle:"linear"===f.settings.axisScale.yAxis&&(r=f.yScale(i)),e.objs.bubble[s].attr("cx",o).attr("cy",r);var n,b;n=e.objs.bubble[s].attr("r"),b=e.objs.bubble[s].style("fill"),e.objs.bubble[s].on("mouseover",p(l,o,r,n,b)).on("mouseout",d())}}},f.bubblePlots.prepareBubblePlot(),t.select(window).on("resize.bubblePlot",f.bubblePlots.update),f.bubblePlots.update(),f},f},o});