!function(e,t){"use strict";if("object"==typeof exports)module.exports=t(require("d3"),require("crossfilter"));else if("function"==typeof define&&define.amd)define(["d3"],["crossfilter"],function(r,o){return e.a3=t(r,o),e.a3});else if(e.d3&&e.crossfilter)e.a3=t(e.d3,e.crossfilter);else if(console&&console.warn)e.d3?e.crossfilter||console.warn("a3 requires crossfilter to run. Are you missing a reference to crossfilter library?"):console.warn("a3 requires d3 to run.  Are you missing a reference to the d3 library?");else{if(!e.d3)throw"a3 requires d3 to run.  Are you missing a reference to the d3 library?";if(!e.crossfilter)throw"a3 requires crossfilter to run. Are you missing a reference to crossfilter library?"}}(this,function(e,t){"use strict";var r={version:"1.0.0",setUp:null,plot:{}};return r.plot.makeDistroChart=function(t){function r(e,t){return!0!==e||0==t?0:Math.floor(Math.random()*t)-t/2}function o(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function s(t){return t%1!=0?e.format(".2f")(t):e.format(".0f")(t)}function n(t){if("function"==typeof t)return t;if(Array.isArray(t)){var r={},o=0;for(var s in u.groupObjs)r[s]=t[o],o=(o+1)%t.length;return function(e){return r[e]}}return"object"==typeof t?function(e){return t[e]}:e.scaleOrdinal(e.schemeCategory10)}function i(e,t){var r={left:null,right:null,middle:null},o=u.xScale.bandwidth()*(e/100),s=(u.xScale.bandwidth()-o)/2,n=u.xScale(t);return r.middle=u.xScale.bandwidth()/2+n,r.left=s+n,r.right=r.left+o,r}function l(e){var t=Math.log(e)/Math.log(10)+1e-6;return Math.abs(t-Math.floor(t))<.6?s(e):""}function a(e,t){var r="Group: "+e;return r+="<br>Max: "+s(t.max,.1),r+="<br>Q3: "+s(t.quartile3),r+="<br>Median: "+s(t.median),r+="<br>Mean: "+s(t.mean),r+="<br>Q1: "+s(t.quartile1),r+="<br>Min: "+s(t.min),function(){u.objs.tooltip.transition().duration(200).style("opacity",.9),u.objs.tooltip.html(r)}}var u={settings:{},yFormatter:null,yScale:null,xScale:null,data:null,groupObjs:{},objs:{},colorFunct:null,margin:{},svgWidth:null,svgHeight:null,width:null,height:null,xAxisLabel:null,yAxisLabel:null,range:{},selector:null};u.settings={data:null,xName:null,yName:null,selector:null,axisLabels:{xAxis:null,yAxis:null},yTicks:1,scale:"linear",chartSize:{width:800,height:400},margin:{top:15,right:40,bottom:40,left:50},constrainExtremes:!1,colors:e.scaleOrdinal(e.schemeCategory10)};for(var c in t)u.settings[c]=t[c];return u.data=u.settings.data,u.objs={mainDiv:null,innerDiv:null,chartDiv:null,svg:null,g:null,axes:null,xAxis:null,yAxis:null,tooltip:null},u.update=function(){return u.width=parseInt(u.objs.chartDiv.style("width"),10)-(u.margin.left+u.margin.right),u.height=parseInt(u.objs.chartDiv.style("height"),10)-(u.margin.top+u.margin.bottom),u.xScale.range([0,u.width]),u.yScale.range([u.height,0]),u.objs.g.select(".x.axis").attr("transform","translate(0,"+u.height+")").call(u.objs.xAxis),u.objs.g.select(".y.axis").call(u.objs.yAxis.tickSizeInner(-u.width)),u.objs.g.select(".x.axis .label").attr("x",u.width/2),u.objs.g.select(".y.axis .label").attr("x",-u.height/2),u},function(){var t,r=null,o=null;for(t=0;t<u.data.length;t++)r=u.data[t][u.settings.xName],o=u.data[t][u.settings.yName],u.groupObjs.hasOwnProperty(r)?u.groupObjs[r].values.push(o):(u.groupObjs[r]={},u.groupObjs[r].values=[o]);for(var s in u.groupObjs)u.groupObjs[s].values.sort(e.ascending),u.groupObjs[s].boxMetrics={},u.groupObjs[s].boxMetrics=function(t){var r={max:null,upperOuterFence:null,upperInnerFence:null,quartile3:null,median:null,mean:null,quartile1:null,iqr:null,lowerInnerFence:null,lowerOuterFence:null,min:null};r.max=e.max(t),r.quartile3=e.quantile(t,.75),r.median=e.median(t),r.mean=e.mean(t),r.quartile1=e.quantile(t,.25),r.iqr=r.quartile3-r.quartile1,r.min=e.min(t);for(var o=r.quartile1-1.5*r.iqr,s=r.quartile3+1.5*r.iqr,n=0;n<t.length;n++)if(!(t[n]<o))if(!r.lowerInnerFence&&t[n]>=o)r.lowerInnerFence=t[n];else if(t[n]>s){r.upperInnerFence=t[n-1];break}return r.lowerOuterFence=r.quartile1-3*r.iqr,r.upperOuterFence=r.quartile3+3*r.iqr,r.lowerInnerFence||(r.lowerInnerFence=r.min),r.upperInnerFence||(r.upperInnerFence=r.max),r}(u.groupObjs[s].values);console.log("Chart = "),console.log(u)}(),function(){if(u.margin=u.settings.margin,u.svgWidth=u.settings.chartSize.width,u.svgHeight=u.settings.chartSize.height,u.width=u.settings.chartSize.width-u.margin.left-u.margin.right,u.height=u.settings.chartSize.height-u.margin.top-u.margin.bottom,u.colorFunct=n(u.settings.colors),u.settings.axisLabels.xAxis||u.settings.axisLabels.yAxis?(u.xAxisLabel=u.settings.axisLabels.xAxis,u.yAxisLabel=u.settings.axisLabels.yAxis):(u.xAxisLabel=u.settings.xName,u.yAxisLabel=u.settings.yName),"log"===u.settings.scale?(u.yScale=e.scaleLog(),u.yFormatter=l):(u.yScale=e.scaleLinear(),u.yFormatter=s),!0===u.settings.constrainExtremes){var t=[];for(var r in u.groupObjs)t.push(u.groupObjs[r].boxMetrics.lowerInnerFence),t.push(u.groupObjs[r].boxMetrics.upperInnerFence);u.range=e.extent(t)}else u.range=e.extent(u.data,function(e){return e[u.settings.yName]});console.log("Chart Range = "),console.log(u.range),u.yScale.range([u.height,0]).domain(u.range).nice().clamp(!0),u.xScale=e.scaleBand().domain(Object.keys(u.groupObjs)).range([0,u.width]),u.objs.yAxis=e.axisLeft().scale(u.yScale).tickFormat(u.yFormatter).tickSizeOuter(0).tickSizeInner(-u.width+(u.margin.right+u.margin.left)),u.objs.yAxis.ticks(10*u.settings.yTicks),u.objs.xAxis=e.axisBottom().scale(u.xScale).tickSize(5)}(),function(){u.objs.mainDiv=e.select(u.settings.selector).style("max-width",u.svgWidth+"px"),u.objs.innerDiv=u.objs.mainDiv.append("div").attr("class","inner-wrapper"),u.objs.innerDiv.append("div").attr("class","outer-box").append("div").attr("class","inner-box"),u.selector=u.objs.innerDiv.select(".inner-box"),u.objs.chartDiv=u.selector,e.select(window).on("resize.chartInnerBox",u.update),u.objs.svg=u.objs.chartDiv.append("svg").attr("class","chart-area").attr("width",u.svgWidth).attr("height",u.svgHeight),u.objs.g=u.objs.svg.append("g").attr("transform","translate("+u.margin.left+","+u.margin.top+")"),u.objs.axes=u.objs.g.append("g").attr("class","axes"),u.objs.axes.append("g").attr("class","y axis").call(u.objs.yAxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",-50).attr("x",-u.height/2).attr("dy",".71em").attr("fill","black").style("text-anchor","middle").style("font-weight","bold").text(u.yAxisLabel.toUpperCase()),u.objs.axes.append("g").attr("class","x axis").attr("transform","translate(0,"+u.height+")").call(u.objs.xAxis).append("text").attr("class","label").attr("x",u.width/2).attr("y",35).attr("dx",".25em").attr("fill","black").style("text-anchor","middle").style("font-weight","bold").text(u.xAxisLabel.toUpperCase()),u.objs.tooltip=u.objs.mainDiv.append("div").attr("class","tooltip");for(var t in u.groupObjs)u.groupObjs[t].g=u.objs.g.append("g").attr("class","group"),u.groupObjs[t].g.on("mouseover",function(){u.objs.tooltip.style("display",null).style("left",e.event.pageX+"px").style("top",e.event.pageY-28+"px")}).on("mouseout",function(){u.objs.tooltip.style("display","none")}).on("mousemove",a(t,u.groupObjs[t].boxMetrics));u.update()}(),u.renderBoxPlot=function(t){u.boxPlots={};var s={show:!0,showBox:!0,showWhiskers:!0,showMedian:!0,showMean:!1,medianCSize:3.5,meanCSize:3.5,showOutliers:!0,boxWidth:30,lineWidth:null,scatterOutliers:!0,outlierCSize:2.5,extremeCSize:2.5,colors:u.colorFunct};u.boxPlots.options=o(s);for(var l in t)u.boxPlots.options[l]=t[l];var a=u.boxPlots.options;for(var c in u.groupObjs)u.groupObjs[c].boxPlot={},u.groupObjs[c].boxPlot.objs={};var b=function(){for(var e in u.groupObjs)!function(e){var t,r,o=[],s=[];for(r=0;r<e.values.length;r++)(t={value:e.values[r]}).value<e.boxMetrics.lowerInnerFence?t.value<e.boxMetrics.lowerOuterFence?o.push(t):s.push(t):t.value>e.boxMetrics.upperInnerFence&&(t.value>e.boxMetrics.upperOuterFence?o.push(t):s.push(t));e.boxPlot.objs.outliers=s,e.boxPlot.objs.extremes=o}(u.groupObjs[e])}();return u.boxPlots.change=function(e){if(e)for(var t in e)a[t]=e[t];for(var r in u.groupObjs)u.groupObjs[r].boxPlot.objs.g.remove();u.boxPlots.prepareBoxPlot(),u.boxPlots.update()},u.boxPlots.hide=function(e){void 0!==e?(e.show=!1,e.reset&&u.boxPlots.reset()):e={show:!1},u.boxPlots.change(e)},u.boxPlots.prepareBoxPlot=function(){var e,t;if(a.colors?u.boxPlots.color=n(a.colors):u.boxPlots.color=u.colorFunct,0!=a.show)for(e in u.groupObjs)if(t=u.groupObjs[e].boxPlot,t.objs.g=u.groupObjs[e].g.append("g").attr("class","box-plot"),a.showBox&&(t.objs.box=t.objs.g.append("rect").attr("class","box").style("fill",u.boxPlots.color(e)).style("stroke",u.boxPlots.color(e))),a.showMedian&&(t.objs.median={line:null,circle:null},t.objs.median.line=t.objs.g.append("line").attr("class","median"),t.objs.median.circle=t.objs.g.append("circle").attr("class","median").attr("r",a.medianCSize).style("fill",u.boxPlots.color(e))),a.showMean&&(t.objs.mean={line:null,circle:null},t.objs.mean.line=t.objs.g.append("line").attr("class","mean"),t.objs.mean.circle=t.objs.g.append("circle").attr("class","mean").attr("r",a.meanCSize).style("fill",u.boxPlots.color(e))),a.showWhiskers&&(t.objs.upperWhisker={fence:null,line:null},t.objs.lowerWhisker={fence:null,line:null},t.objs.upperWhisker.fence=t.objs.g.append("line").attr("class","upper whisker").style("stroke",u.boxPlots.color(e)),t.objs.upperWhisker.line=t.objs.g.append("line").attr("class","upper whisker").style("stroke",u.boxPlots.color(e)),t.objs.lowerWhisker.fence=t.objs.g.append("line").attr("class","lower whisker").style("stroke",u.boxPlots.color(e)),t.objs.lowerWhisker.line=t.objs.g.append("line").attr("class","lower whisker").style("stroke",u.boxPlots.color(e))),a.showOutliers){t.objs.outliers||b();var r;if(t.objs.outliers.length){var o=t.objs.g.append("g").attr("class","boxplot outliers");for(r in t.objs.outliers)t.objs.outliers[r].point=o.append("circle").attr("class","outlier").attr("r",a.outlierCSize).style("fill",u.boxPlots.color(e))}if(t.objs.extremes.length){var s=t.objs.g.append("g").attr("class","boxplot extremes");for(r in t.objs.extremes)t.objs.extremes[r].point=s.append("circle").attr("class","extreme").attr("r",a.extremeCSize).style("stroke",u.boxPlots.color(e))}}},u.boxPlots.reset=function(){u.boxPlots.change(s)},u.boxPlots.show=function(e){void 0!==e?(e.show=!0,e.reset&&u.boxPlots.reset()):e={show:!0},u.boxPlots.change(e)},u.boxPlots.update=function(){var e,t;for(e in u.groupObjs){t=u.groupObjs[e].boxPlot;var o=i(a.boxWidth,e),s=o.right-o.left,n={};for(var l in u.groupObjs[e].boxMetrics)n[l]=null,n[l]=u.yScale(u.groupObjs[e].boxMetrics[l]);t.objs.box&&t.objs.box.attr("x",o.left).attr("width",s).attr("y",n.quartile3).attr("rx",1).attr("ry",1).attr("height",-n.quartile3+n.quartile1);var c=null;c=a.lineWidth?i(a.lineWidth,e):o,t.objs.upperWhisker&&(t.objs.upperWhisker.fence.attr("x1",c.left).attr("x2",c.right).attr("y1",n.upperInnerFence).attr("y2",n.upperInnerFence),t.objs.upperWhisker.line.attr("x1",c.middle).attr("x2",c.middle).attr("y1",n.quartile3).attr("y2",n.upperInnerFence),t.objs.lowerWhisker.fence.attr("x1",c.left).attr("x2",c.right).attr("y1",n.lowerInnerFence).attr("y2",n.lowerInnerFence),t.objs.lowerWhisker.line.attr("x1",c.middle).attr("x2",c.middle).attr("y1",n.quartile1).attr("y2",n.lowerInnerFence)),t.objs.median&&(t.objs.median.line.attr("x1",c.left).attr("x2",c.right).attr("y1",n.median).attr("y2",n.median),t.objs.median.circle.attr("cx",c.middle).attr("cy",n.median)),t.objs.mean&&(t.objs.mean.line.attr("x1",c.left).attr("x2",c.right).attr("y1",n.mean).attr("y2",n.mean),t.objs.mean.circle.attr("cx",c.middle).attr("cy",n.mean));var b;if(t.objs.outliers&&a.showOutliers)for(b in t.objs.outliers)t.objs.outliers[b].point.attr("cx",o.middle+r(a.scatterOutliers,s)).attr("cy",u.yScale(t.objs.outliers[b].value));if(t.objs.extremes&&a.showOutliers)for(b in t.objs.extremes)t.objs.extremes[b].point.attr("cx",o.middle+r(a.scatterOutliers,s)).attr("cy",u.yScale(t.objs.extremes[b].value))}},u.boxPlots.prepareBoxPlot(),e.select(window).on("resize.boxPlot",u.boxPlots.update),u.boxPlots.update(),u},u.renderViolinPlot=function(t){function r(e){return function(t){return Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}}function s(t,r){return function(o){return e.mean(r,function(e){return t(o-e)})}}function l(t,r){return function(o){return r.map(function(r){return{x:r,y:e.mean(o,function(e){return t(r-e)})}})}}u.violinPlots={};var a={show:!0,showViolinPlot:!0,resolution:100,bandWidth:20,width:50,interpolation:e.curveCardinal,clamp:0,colors:u.colorFunct,_yDomainVP:null};u.violinPlots.options=o(a);for(var c in t)u.violinPlots.options[c]=t[c];var b=u.violinPlots.options;for(var p in u.groupObjs)u.groupObjs[p].violin={},u.groupObjs[p].violin.objs={};return u.violinPlots.change=function(e){if(e)for(var t in e)b[t]=e[t];for(var r in u.groupObjs)u.groupObjs[r].violin.objs.g.remove();u.violinPlots.prepareViolin(),u.violinPlots.update()},u.violinPlots.hide=function(e){void 0!==e?(e.show=!1,e.reset&&u.violinPlots.reset()):e={show:!1},u.violinPlots.change(e)},u.violinPlots.prepareViolin=function(){var e,t;if(b.colors?u.violinPlots.color=n(b.colors):u.violinPlots.color=u.colorFunct,0!=b.show)for(e in u.groupObjs)(t=u.groupObjs[e].violin).objs.g=u.groupObjs[e].g.append("g").attr("class","violin-plot"),t.objs.left={area:null,line:null,g:t.objs.g.append("g")},t.objs.right={area:null,line:null,g:t.objs.g.append("g")},!1!==b.showViolinPlot&&(t.objs.left.area=t.objs.left.g.append("path").attr("class","area").style("fill",u.violinPlots.color(e)),t.objs.right.area=t.objs.right.g.append("path").attr("class","area").style("fill",u.violinPlots.color(e)),t.objs.left.line=t.objs.left.g.append("path").attr("class","line").style("fill","none").style("stroke",u.violinPlots.color(e)),t.objs.right.line=t.objs.right.g.append("path").attr("class","line").style("fill","none").style("stroke",u.violinPlots.color(e)))},u.violinPlots.reset=function(){u.violinPlots.change(a)},u.violinPlots.show=function(e){void 0!==e?(e.show=!0,e.reset&&u.violinPlots.reset()):e={show:!0},u.violinPlots.change(e)},u.violinPlots.update=function(){var t,o;for(t in u.groupObjs){o=u.groupObjs[t].violin;var n=u.yScale.copy();o.kde=l(r(b.bandWidth),n.ticks(b.resolution)),o.kdeData=o.kde(u.groupObjs[t].values);var a=u.groupObjs[t].boxMetrics.max,c=u.groupObjs[t].boxMetrics.min;if(0==b.clamp||-1==b.clamp){if(a=e.min(o.kdeData.filter(function(e){return e.x>u.groupObjs[t].boxMetrics.max&&0==e.y}),function(e){return e.x}),c=e.max(o.kdeData.filter(function(e){return e.x<u.groupObjs[t].boxMetrics.min&&0==e.y}),function(e){return e.x}),-1==b.clamp){var p=s(r(b.bandWidth),u.groupObjs[t].values);if(!a){for(var g=p(u.groupObjs[t].boxMetrics.max),x=u.groupObjs[t].boxMetrics.max,d=25;d>0&&0!=g;)g=p(x),x+=1,d-=1;a=x}if(!c){for(var f=p(u.groupObjs[t].boxMetrics.min),h=u.groupObjs[t].boxMetrics.min,d=25;d>0&&0!=f;)f=p(h),h-=1,d-=1;c=h}}b._yDomainVP||(b._yDomainVP=u.range.slice(0)),c&&c<b._yDomainVP[0]&&(b._yDomainVP[0]=c),a&&a>b._yDomainVP[1]&&(b._yDomainVP[1]=a)}b.showViolinPlot&&(u.update(),n=u.yScale.copy(),o.kde=l(r(b.bandWidth),n.ticks(b.resolution)),o.kdeData=o.kde(u.groupObjs[t].values)),o.kdeData=o.kdeData.filter(function(e){return!c||e.x>=c}).filter(function(e){return!a||e.x<=a})}for(t in u.groupObjs){o=u.groupObjs[t].violin;var j=i(b.width,t),m=(j.right-j.left)/2,v=e.scaleLinear().range([m,0]).domain([0,e.max(o.kdeData,function(e){return e.y})]).clamp(!0),y=e.area().curve(b.interpolation).x(function(e){return n(e.x)}).y0(m).y1(function(e){return v(e.y)}),w=e.line().curve(b.interpolation).x(function(e){return n(e.x)}).y(function(e){return v(e.y)});o.objs.left.area&&(o.objs.left.area.datum(o.kdeData).attr("d",y),o.objs.left.line.datum(o.kdeData).attr("d",w),o.objs.right.area.datum(o.kdeData).attr("d",y),o.objs.right.line.datum(o.kdeData).attr("d",w)),o.objs.left.g.attr("transform","rotate(90,0,0)   translate(0,-"+j.left+")  scale(1,-1)"),o.objs.right.g.attr("transform","rotate(90,0,0)  translate(0,-"+j.right+")")}},u.violinPlots.prepareViolin(),e.select(window).on("resize.violinPlot",u.violinPlots.update),u.violinPlots.update(),u},u},r});